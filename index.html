
<!DOCTYPE html>
<html>
<head>
	<!-- Standard Meta -->
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="apple-mobile-web-app-capable" content="yes">
    	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">


	<!-- Site Properties -->
	<title>Tags</title>
	<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.1/semantic.min.css">
	<style type="text/css">
	label.disabled { background-color:#eee; }
	.ui.ribbon.label { top: -0.5em; margin-bottom:5px; }
	.ui.inverted.custom.segment { background-color: #033c5d!important; color: #FFF!important; }
	.ui.inverted.dimmer { background-color: rgba(255,255,255,1); }

	.ui.label.icon>.icon { width: auto; margin: 0; }
	a.ui.label { margin: 0 2px 4px 0; }

	main { margin-top: 1em; }

	.ui.right.floated.menu { position: absolute; top: -1px; right: -1px; border-radius: 0 0 0 5px; border: 1px solid #ccc; }

	</style>
	<script type="text/javascript" src="https://cdn.jsdelivr.net/lodash/4.16.4/lodash.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.0/knockout-min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.1/semantic.min.js"></script>
	<script type="text/javascript">
	$(document).ready(function() {
		var mockViewmodel = function() {

			var self = this;

			// Class for creating tags
			self.TAG = function(tag) {
				this.name = tag;
				this.isActive = ko.observable(false);
			};

			self.mock = [
				new self.TAG("OlympusOMD"),
				new self.TAG("igScandinavia"),
				new self.TAG("em5markii"),
				new self.TAG("OmdEm5MarkII"),
				new self.TAG("Olympus"),
				new self.TAG("OlympusCamera")
			];

			self.tags = ko.observableArray(self.mock);

			self.hashtags = ko.observableArray([
				{
					name : "My own hashtags",
					color: 'blue',
					hashtags : ko.observableArray(self.mock)
				}, {
					name : "Sweden & Scandinavia",
					color: 'teal',
					hashtags : ko.observableArray([
						new self.TAG("Sweden"),
						new self.TAG("Sverige"),
						new self.TAG("VisitSweden"),
						new self.TAG("Loves_Sweden"),
						new self.TAG("ig_sweden"),
						new self.TAG("igSweden"),
						new self.TAG("Sweden_PhotoLovers"),
						new self.TAG("BestOfScandinavia"),
						new self.TAG("igScandinavia")
					])
				}, {
					name : "Landscape",
					color: 'green',
					hashtags : ko.observableArray([
						new self.TAG("Landscape_Lovers"),
						new self.TAG("Landscape_Captures"),
						new self.TAG("LandscapePhotography"),
						new self.TAG("NatureLovers"),
						new self.TAG("NatureGram"),
						new self.TAG("Nature_Perfection"),
						new self.TAG("MotherNature"),
						new self.TAG("AllNatureShots"),
						new self.TAG("reflection_perfection"),
						new self.TAG("Country_Features"),
						new self.TAG("ig_Countryside"),
						new self.TAG("AwesomeEarth"),
						new self.TAG("Awesome_EarthPix")
					])
				},{
					name : "Astrophotography",
					color: 'black',
					hashtags : ko.observableArray([
						new self.TAG("NightScape"),
						new self.TAG("NightPhotography"),
						new self.TAG("NightScaper"),
						new self.TAG("LongexpoElite"),
						new self.TAG("AstroPhotography"),
						new self.TAG("StarryNight"),
						new self.TAG("NightShooters"),
						new self.TAG("SkyMasters"),
						new self.TAG("MilkyWay"),
						new self.TAG("Stargazer"),
						new self.TAG("InstaSky"),
						new self.TAG("Sky_Brilliance")
					])
				}, {
					name : "Popular",
					color: 'red',
					hashtags : ko.observableArray([
						new self.TAG("WatchThisInstagood"),
						new self.TAG("LiveFolk"),
						new self.TAG("ArtOfVisuals"),
						new self.TAG("LiveAuthentic"),
						new self.TAG("WeLiveToExplore"),
						new self.TAG("MoodyGrams"),
						new self.TAG("igMood"),
						new self.TAG("Jaw_Dropping_Shots"),
						new self.TAG("PicOfTheDay"),
						new self.TAG("OurPlanetDaily"),
						new self.TAG("colors_of_day"),
						new self.TAG("unlimitedplanet")
					])
				}
			]);

			self.hashtagizer = function(tag) {
				return '#' + tag;
			}

			self.toggleAll = function(arrayRef, state) {
				console.log("toggleAll");
				console.log(state);
				_.forEach(arrayRef(), function(value) {
					if (state) {
						self.addTag(value);
					} else {
						self.removeTag(value);
					}
				});
			};

			self.exportTags = ko.observableArray([]);
			self.exportTagsForCopy = ko.computed(function() {
				var result = [""];
				_.forEach(self.exportTags(), function(value) {
					result.push(value.name);
				});
				return result.join(' #');
			}, this);

			self.addTag = function(tag) {
				if (_.indexOf(self.exportTags(), tag) === -1) {
					tag.isActive(true);
					self.exportTags().push(tag);
					self.exportTags.valueHasMutated();
					self.tags.valueHasMutated();
				}
			}

			self.removeTag = function(tag) {
				tag.isActive(false);
				self.exportTags(_.without(self.exportTags(), tag));
				self.exportTags.valueHasMutated();
			};

			self.createTag = function(item, event) {
				$(event.target).closest('.segment').dimmer('show');
				$(event.target).closest('.segment').find(":input:text").focus();
			}

			self.saveNewHashtag = function(item, event) {
				var newHastag = new self.TAG($(event.target).siblings(':input:text').val());
				item.hashtags().push(newHastag);
				item.hashtags.valueHasMutated();
				$(event.target).siblings(':input:text').val("").closest('.segment').dimmer('hide');
			};

			self.createGroupIsActivated = ko.observable(false);

			self.toggleCreateGroup = function(item, event) {
				self.createGroupIsActivated(true);
			};

			self.setTagClass = function(item, parent) {
				if (item.isActive()) {
					return 'basic disabled';
				} else {
					return parent.color;
				}
			}

			self.saveNewGroup = function() {
				console.log(self.hashtags());
				self.hashtags().push({
					name : $("#groupName").val(),
					hashtags : ko.observableArray([])
				});
				console.log(self.hashtags());
				self.hashtags.valueHasMutated();
				self.createGroupIsActivated(false);
			};

			self.afterRender = function() {
				//$('a[title]').popup();
				new Clipboard('#copy-button');
			};

		};

		

	    window.mockViewmodel = new mockViewmodel();
	    ko.applyBindings(window.mockViewmodel);

	    setTimeout(function() {
	    	window.mockViewmodel.afterRender();
	    }, 1500);

	});
	</script>
</head>
<body>
<div class="ui">

	<main class="ui container">

	<div class="ui top attached custom inverted segment">	
		<div class="ui grid">
			<div class="eleven wide column">
				<h2 class="ui icon">
				  	<i class="icon instagram"></i> Instatags
				</h2>
			</div>
			<div class="five wide column">
				<button class="ui small basic inverted right floated icon button" data-bind="click : function() { $root.createGroupIsActivated(!$root.createGroupIsActivated()); }"><i class="plus icon"></i> Group</button>
			</div>
		</div>
	</div>

	<div class="ui attached message info" data-bind="visible : createGroupIsActivated()">
		<h3>Create a new group of hashtags</h3>
		<div class="ui left icon input">
			<i class="archive icon"></i>
			<input type="text" placeholder="Name the new group..." id="groupName" data-bind="hasfocus : createGroupIsActivated()">
		</div>
		<button class="ui green icon button" data-bind="click: function() { $root.saveNewGroup(); }"><i class="icon save"></i> Save</button>
		<button class="ui grey icon button" data-bind="click : function() { $root.createGroupIsActivated(!$root.createGroupIsActivated()); }"><i class="icon close"></i> Cancel</button>
	</div>

	<!-- ko foreach: hashtags -->
	<section class="ui attached segment hashtaggroup">

		<div class="ui inverted dimmer">
			<div class="content">
				<div class="center">
					<form class="ui form">
						<div class="ui internally celled grid">
							<div class="row">
								<div class="column">
									<div class="ui fluid right action left icon input">
										<i class="tag icon"></i>
										<input type="text" placeholder="Create a new tag...">
										<button class="ui teal right labeled icon button" data-bind="click: $root.saveNewHashtag"><i class="plus icon"></i> Save</button>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>

		<span class="ui tiny ribbon label" data-bind="css : $data.color"><i class="icon archive"></i> <span data-bind="text : $data.name"></span> (<span data-bind="text : $data.hashtags().length">0</span>)</span>

		<div>
	    	<!-- ko foreach: $data.hashtags -->
			<a class="ui label" data-bind="html: $root.hashtagizer($data.name), click : function() { $root.addTag($data); }, css : $root.setTagClass($data, $parent) "></a>
			<!-- /ko -->
			<a class="ui icon label" title="Create new tag" href="#" data-bind="click : $root.createTag"><i class="icon plus"></i></a>
			<a class="ui icon label" title="Add all tags to selected" href="#" data-bind="click : function() { $root.toggleAll($data.hashtags, true); }"><i class="icon level down"></i></a>
			<a class="ui icon label" title="Remove all tags from selected" href="#" data-bind="click : function() { $root.toggleAll($data.hashtags, false); }"><i class="icon refresh"></i></a>
		</div>


  	</section>
	<!-- /ko -->

	<div class="ui bottom attached segment">
		<span class="ui tiny ribbon green label"><i class="icon tags"></i> Selected hashtags (<span data-bind="text : exportTags().length">0</span>)</span>

      	<!-- ko if: !exportTags().length -->
			<span><i class="icon idea"></i> No hashtag selected. Click to select</span>
      	<!-- /ko -->

		<!-- ko foreach: exportTags -->
		<a class="ui green label" data-bind="html: $root.hashtagizer($data.name) + ' <i class=\'icon close\'></i>', click : function() { $root.removeTag($data); }"></a>
		<!-- /ko -->
		<div class="ui divider hidden"></div>

		<div class="ui form">

			<div class="ui fluid action input">
			  <input type="text" data-bind="value: exportTagsForCopy" id="tagsforexport">
			  <button id="copy-button" class="ui teal right labeled icon button" data-clipboard-target="#tagsforexport">
			    <i class="copy icon"></i>
			    Copy
			  </button>
			</div>
		</div>
	</div>

</main>



</div>
</body>
</html>
